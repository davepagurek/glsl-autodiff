/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it uses a non-standard name for the exports (exports).
(() => {
var exports = __webpack_exports__;
/*!******************!*\
  !*** ./index.ts ***!
  \******************/

Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AutoDiff = void 0;
class Op {
    constructor(ad, ...params) {
        this.usedIn = [];
        this.ad = ad;
        this.id = ad.getNextID();
        this.dependsOn = params;
        for (const param of params) {
            param.usedIn.push(this);
        }
    }
    ref() {
        if (this.usedIn.length > 1) {
            return `_glslad_v${this.id}`;
        }
        else {
            return `(${this.definition()})`;
        }
    }
    derivRef(param) {
        if (this.usedIn.length > 1) {
            return `_glslad_dv${this.id}_d${param.name}`;
        }
        else {
            return `(${this.derivative(param)})`;
        }
    }
    initializer() {
        if (this.usedIn.length > 1) {
            return `float ${this.ref()}=${this.definition()};\n`;
        }
        else {
            return '';
        }
    }
    derivInitializer(param) {
        if (this.usedIn.length > 1) {
            return `float ${this.derivRef(param)}=${this.derivative(param)};\n`;
        }
        else {
            return '';
        }
    }
    isConst() {
        return this.dependsOn.every((op) => op.isConst());
    }
    deepDependencies() {
        const deps = new Set();
        for (const op of this.dependsOn) {
            for (const dep of op.deepDependencies().values()) {
                deps.add(dep);
            }
            deps.add(op);
        }
        return deps;
    }
    add(...params) { return this.ad.add(this, ...params); }
    sum(...params) { return this.ad.sum(this, ...params); }
    sub(b) { return this.ad.sub(this, b); }
    neg() { return this.ad.neg(this); }
    mult(...params) { return this.ad.mult(this, ...params); }
    div(b) { return this.ad.div(this, b); }
    pow(b) { return this.ad.pow(this, b); }
    sqrt() { return this.ad.sqrt(this); }
    sin() { return this.ad.sin(this); }
    cos() { return this.ad.cos(this); }
    tan() { return this.ad.cos(this); }
    mix(b, mix) { return this.ad.mix(this, b, mix); }
    clamp(min, max) { return this.ad.clamp(this, min, max); }
    min(other) { return this.ad.min(this, other); }
    max(other) { return this.ad.max(this, other); }
    ifelse(thenOp, elseOp) { return this.ad.ifelse(this, thenOp, elseOp); }
    output(name) { return this.ad.output(name, this); }
    outputDeriv(name, param) { return this.ad.outputDeriv(name, param, this); }
}
class OpLiteral extends Op {
    initializer() { return ''; }
    derivInitializer() { return ''; }
    ref() { return this.definition(); }
    derivRef(param) { return this.derivative(param); }
}
class Param extends OpLiteral {
    constructor(ad, name) {
        super(ad);
        this.name = name;
    }
    isConst() { return false; }
    definition() { return this.name; }
    derivative(param) {
        if (param === this) {
            return '1.0';
        }
        else {
            return '0.0';
        }
    }
}
class Value extends OpLiteral {
    constructor(ad, val) {
        super(ad);
        this.val = val;
    }
    isConst() { return true; }
    definition() { return `${this.val.toFixed(4)}`; }
    derivative() { return '0.0'; }
}
class Neg extends Op {
    definition() {
        return `-${this.dependsOn[0].ref()}`;
    }
    derivative(param) {
        return '-' + this.dependsOn[0].derivRef(param);
    }
}
class Sum extends Op {
    definition() {
        return this.dependsOn.map((op) => op.ref()).join('+');
    }
    derivative(param) {
        return this.dependsOn.map((op) => op.derivRef(param)).join('+');
    }
}
class Mult extends Op {
    definition() {
        return this.dependsOn.map((op) => op.ref()).join('*');
    }
    derivative(param) {
        const [f, g] = this.dependsOn;
        return `${f.ref()}*${g.derivRef(param)}+${g.ref()}*${f.derivRef(param)}`;
    }
}
class Div extends Op {
    definition() {
        return this.dependsOn.map((op) => op.ref()).join('/');
    }
    derivative(param) {
        const [f, g] = this.dependsOn;
        return `(${f.derivRef(param)}*${g.ref()}-${g.derivRef(param)}*${f.ref()})/(${g.ref()}*${g.ref()})`;
    }
}
class Pow extends Op {
    definition() {
        return `pow(${this.dependsOn[0].ref()},${this.dependsOn[1].ref()})`;
    }
    derivative(param) {
        const [a, b] = this.dependsOn;
        if (b.isConst()) {
            return `${b.ref()}*pow(${a.ref()},${b.ref()}-1.0)`;
        }
        else {
            return `pow(${a.ref()},${b.ref()})*log(${a.ref()})*${b.derivRef(param)}`;
        }
    }
}
class Sin extends Op {
    definition() {
        return `sin(${this.dependsOn[0].ref()})`;
    }
    derivative(param) {
        return `cos(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(param)}`;
    }
}
class Cos extends Op {
    definition() {
        return `cos(${this.dependsOn[0].ref()})`;
    }
    derivative(param) {
        return `-sin(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(param)}`;
    }
}
class Mix extends Op {
    definition() {
        return `mix(${this.dependsOn.map((op) => op.ref()).join(',')})`;
    }
    derivative(param) {
        const [a, b, mix] = this.dependsOn;
        const aDeriv = `(1.0-${a.ref()})*${mix.derivRef(param)}+(-${a.derivRef(param)})*${mix.ref()}`;
        const bDeriv = `${b.ref()}*${mix.derivRef(param)}+${b.derivRef(param)}*${mix.ref()}`;
        return `${aDeriv}+${bDeriv}`;
    }
}
class Clamp extends Op {
    definition() {
        return `clamp(${this.dependsOn.map((op) => op.ref()).join(',')})`;
    }
    derivative(param) {
        const [v, min, max] = this.dependsOn;
        return `${v.ref()}<${min.ref()} ? 0.0 : (${v.ref()}>${max.ref()} ? 0.0 : ${v.derivRef(param)})`;
    }
}
class Min extends Op {
    definition() {
        return `min(${this.dependsOn.map((op) => op.ref()).join(',')})`;
    }
    derivative(param) {
        const [a, b] = this.dependsOn;
        return `${a.ref()}<${b.ref()} ? ${a.derivRef(param)} : ${b.derivRef(param)}`;
    }
}
class Max extends Op {
    definition() {
        return `max(${this.dependsOn.map((op) => op.ref()).join(',')})`;
    }
    derivative(param) {
        const [a, b] = this.dependsOn;
        return `${a.ref()}>${b.ref()} ? ${a.derivRef(param)} : ${b.derivRef(param)}`;
    }
}
class IfElse extends Op {
    definition() {
        const [condition, thenOp, elseOp] = this.dependsOn;
        return `${condition.ref()}?${thenOp.ref()}:${elseOp.ref()}`;
    }
    derivative(param) {
        const [condition, thenOp, elseOp] = this.dependsOn;
        return `${condition.ref()}?${thenOp.derivRef(param)}:${elseOp.derivRef(param)}`;
    }
}
class AutoDiff {
    constructor() {
        this.nextID = 0;
        this.params = {};
        this.outputs = {};
        this.derivOutputs = {};
    }
    getNextID() {
        const id = this.nextID;
        this.nextID++;
        return id;
    }
    convertVal(param) {
        if (param instanceof Op) {
            return param;
        }
        else {
            return this.val(param);
        }
    }
    convertVals(params) {
        return params.map((param) => this.convertVal(param));
    }
    val(n) { return new Value(this, n); }
    sum(...params) { return new Sum(this, ...this.convertVals(params)); }
    add(...params) { return new Sum(this, ...this.convertVals(params)); }
    sub(a, b) {
        const [opA, opB] = this.convertVals([a, b]);
        return this.sum(opA, this.neg(opB));
    }
    neg(v) { return new Neg(this, this.convertVal(v)); }
    mult(...params) {
        if (params.length === 2) {
            return new Mult(this, ...this.convertVals(params));
        }
        else if (params.length > 2) {
            return new Mult(this, this.convertVals(params.slice(0, 1))[0], this.mult(...params.slice(1)));
        }
        else {
            throw new Error(`mult() called with too few arguments: ${params}`);
        }
    }
    div(a, b) {
        const [opA, opB] = this.convertVals([a, b]);
        return new Div(this, opA, opB);
    }
    pow(a, b) {
        const [opA, opB] = this.convertVals([a, b]);
        return new Pow(this, opA, opB);
    }
    sqrt(v) { return new Pow(this, this.convertVal(v), this.val(0.5)); }
    sin(v) { return new Sin(this, this.convertVal(v)); }
    cos(v) { return new Cos(this, this.convertVal(v)); }
    tan(v) {
        const op = this.convertVal(v);
        return this.div(this.sin(op), this.cos(op));
    }
    mix(a, b, mix) { return new Mix(this, ...this.convertVals([a, b, mix])); }
    clamp(v, min, max) { return new Clamp(this, ...this.convertVals([v, min, max])); }
    min(a, b) { return new Min(this, ...this.convertVals([a, b])); }
    max(a, b) { return new Max(this, ...this.convertVals([a, b])); }
    ifelse(cond, thenOp, elseOp) { return new IfElse(this, ...this.convertVals([cond, thenOp, elseOp])); }
    e() { return this.val(Math.E); }
    pi() { return this.val(Math.PI); }
    param(name) {
        const op = new Param(this, name);
        this.params[name] = op;
        return op;
    }
    output(name, op) {
        this.outputs[name] = op;
    }
    outputDeriv(name, param, op) {
        const paramName = typeof param === 'string' ? param : param.name;
        this.derivOutputs[paramName] = this.derivOutputs[paramName] || {};
        this.derivOutputs[paramName][name] = op;
    }
    gen() {
        let code = '';
        const deps = new Set();
        for (const name in this.outputs) {
            for (const dep of this.outputs[name].deepDependencies().values()) {
                deps.add(dep);
            }
            deps.add(this.outputs[name]);
        }
        for (const param in this.derivOutputs) {
            for (const name in this.derivOutputs[param]) {
                for (const dep of this.derivOutputs[param][name].deepDependencies().values()) {
                    deps.add(dep);
                }
                deps.add(this.derivOutputs[param][name]);
            }
        }
        for (const dep of deps.values()) {
            code += dep.initializer();
        }
        for (const name in this.outputs) {
            code += `float ${name}=${this.outputs[name].ref()};\n`;
        }
        for (const param in this.derivOutputs) {
            const paramOp = this.params[param];
            const derivDeps = new Set();
            for (const name in this.derivOutputs[param]) {
                for (const dep of this.derivOutputs[param][name].deepDependencies().values()) {
                    derivDeps.add(dep);
                }
                derivDeps.add(this.derivOutputs[param][name]);
            }
            for (const dep of derivDeps.values()) {
                code += dep.derivInitializer(paramOp);
            }
            for (const name in this.derivOutputs[param]) {
                code += `float ${name}=${this.derivOutputs[param][name].derivRef(paramOp)};\n`;
            }
        }
        return code;
    }
    static gen(cb) {
        const ad = new AutoDiff();
        cb(ad);
        return ad.gen();
    }
}
exports.AutoDiff = AutoDiff;
window.AutoDiff = window.AutoDiff || AutoDiff;

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFFQSxNQUFlLEVBQUU7SUFPZixZQUFZLEVBQVksRUFBRSxHQUFHLE1BQVk7UUFIbEMsV0FBTSxHQUFTLEVBQUU7UUFJdEIsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFO1FBQ1osSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsU0FBUyxFQUFFO1FBQ3hCLElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTTtRQUN2QixLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBRTtZQUMxQixLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDeEI7SUFDSCxDQUFDO0lBRU0sR0FBRztRQUNSLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzFCLE9BQU8sWUFBWSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQzdCO2FBQU07WUFDTCxPQUFPLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHO1NBQ2hDO0lBQ0gsQ0FBQztJQUVNLFFBQVEsQ0FBQyxLQUFZO1FBQzFCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzFCLE9BQU8sYUFBYSxJQUFJLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FBQyxJQUFJLEVBQUU7U0FDN0M7YUFBTTtZQUNMLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHO1NBQ3JDO0lBQ0gsQ0FBQztJQUVNLFdBQVc7UUFDaEIsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDMUIsT0FBTyxTQUFTLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLEtBQUs7U0FDckQ7YUFBTTtZQUNMLE9BQU8sRUFBRTtTQUNWO0lBQ0gsQ0FBQztJQUVNLGdCQUFnQixDQUFDLEtBQVk7UUFDbEMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDMUIsT0FBTyxTQUFTLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsS0FBSztTQUNwRTthQUFNO1lBQ0wsT0FBTyxFQUFFO1NBQ1Y7SUFDSCxDQUFDO0lBRU0sT0FBTztRQUNaLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0lBRU0sZ0JBQWdCO1FBQ3JCLE1BQU0sSUFBSSxHQUFHLElBQUksR0FBRyxFQUFNO1FBQzFCLEtBQUssTUFBTSxFQUFFLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUMvQixLQUFLLE1BQU0sR0FBRyxJQUFJLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFO2dCQUNoRCxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQzthQUNkO1lBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7U0FDYjtRQUNELE9BQU8sSUFBSTtJQUNiLENBQUM7SUFHTSxHQUFHLENBQUMsR0FBRyxNQUFlLElBQUksT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDO0lBQy9ELEdBQUcsQ0FBQyxHQUFHLE1BQWUsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxFQUFDLENBQUM7SUFDL0QsR0FBRyxDQUFDLENBQVEsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBQyxDQUFDO0lBQzdDLEdBQUcsS0FBSyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUM7SUFDbEMsSUFBSSxDQUFDLEdBQUcsTUFBZSxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLEVBQUMsQ0FBQztJQUNqRSxHQUFHLENBQUMsQ0FBUSxJQUFJLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDN0MsR0FBRyxDQUFDLENBQVEsSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBQyxDQUFDO0lBQzdDLElBQUksS0FBSyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUM7SUFDcEMsR0FBRyxLQUFLLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQztJQUNsQyxHQUFHLEtBQUssT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDO0lBQ2xDLEdBQUcsS0FBSyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUM7SUFDbEMsR0FBRyxDQUFDLENBQVEsRUFBRSxHQUFVLElBQUksT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFDLENBQUM7SUFDOUQsS0FBSyxDQUFDLEdBQVUsRUFBRSxHQUFVLElBQUksT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFDLENBQUM7SUFDdEUsR0FBRyxDQUFDLEtBQVksSUFBSSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLENB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SyxTQUFRLEVBQUU7SUFDbkIsVUFBVTtRQUNSLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDdkQsQ0FBQztJQUNELFVBQVUsQ0FBQyxLQUFZO1FBQ3JCLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVM7UUFDN0IsT0FBTyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFO0lBQzFFLENBQUM7Q0FDRjtBQUVELE1BQU0sR0FBSSxTQUFRLEVBQUU7SUFDbEIsVUFBVTtRQUNSLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDdkQsQ0FBQztJQUNELFVBQVUsQ0FBQyxLQUFZO1FBQ3JCLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVM7UUFDN0IsT0FBTyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUc7SUFDcEcsQ0FBQztDQUNGO0FBRUQsTUFBTSxHQUFJLFNBQVEsRUFBRTtJQUNsQixVQUFVO1FBQ1IsT0FBTyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENB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UUFDakMsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFTSxHQUFHLENBQUMsQ0FBUyxJQUFJLE9BQU8sSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDNUMsR0FBRyxDQUFDLEdBQUcsTUFBZSxJQUFJLE9BQU8sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDN0UsR0FBRyxDQUFDLEdBQUcsTUFBZSxJQUFJLE9BQU8sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDN0UsR0FBRyxDQUFDLENBQVEsRUFBRSxDQUFRO1FBQzNCLE1BQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMzQyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUNNLEdBQUcsQ0FBQyxDQUFRLElBQUksT0FBTyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDMUQsSUFBSSxDQUFDLEdBQUcsTUFBZTtRQUM1QixJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuRDthQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDNUIsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUY7YUFBTTtZQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMseUNBQXlDLE1BQU0sRUFBRSxDQUFDO1NBQ25FO0lBQ0gsQ0FBQztJQUNNLEdBQUcsQ0FBQyxDQUFRLEVBQUUsQ0FBUTtRQUMzQixNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDM0MsT0FBTyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUNoQyxDQUFDO0lBQ00sR0FBRyxDQUFDLENBQVEsRUFBRSxDQUFRO1FBQzNCLE1BQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMzQyxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ2hDLENBQUM7SUFDTSxJQUFJLENBQUMsQ0FBUSxJQUFJLE9BQU8sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDMUUsR0FBRyxDQUFDLENBQVEsSUFBSSxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUMxRCxHQUFHLENBQUMsQ0FBUSxJQUFJLE9BQU8sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDO0lBQzFELEdBQUcsQ0FBQyxDQUFRO1FBQ2pCLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUNNLEdBQUcsQ0FBQyxDQUFRLEVBQUUsQ0FBUSxFQUFFLEdBQVUsSUFBSSxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDO0lBQzlGLEtBQUssQ0FBQyxDQUFRLEVBQUUsR0FBVSxFQUFFLEdBQVUsSUFBSSxPQUFPLElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDO0lBQ3RHLEdBQUcsQ0FBQyxDQUFRLEVBQUUsQ0FBUSxJQUFJLE9BQU8sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUM3RSxHQUFHLENBQUMsQ0FBUSxFQUFFLENBQVEsSUFBSSxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7SUFDN0UsTUFBTSxDQUFDLElBQVcsRUFBRSxNQUFhLEVBQUUsTUFBYSxJQUFJLE9BQU8sSUFBSSxNQUFNLENB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SUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDM0MsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUU7b0JBQzVFLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO2lCQUNuQjtnQkFDRCxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDOUM7WUFDRCxLQUFLLE1BQU0sR0FBRyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEVBQUUsRUFBRTtnQkFDcEMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7YUFDdEM7WUFHRCxLQUFLLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQzNDLElBQUksSUFBSSxTQUFTLElBQUksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSzthQUMvRTtTQUNGO1FBRUQsT0FBTyxJQUFJO0lBQ2IsQ0FBQztJQUlNLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBd0I7UUFDeEMsTUFBTSxFQUFFLEdBQUcsSUFBSSxRQUFRLEVBQUU7UUFDekIsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUNOLE9BQU8sRUFBRSxDQUFDLEdBQUcsRUFBRTtJQUNqQixDQUFDO0NBQ0Y7QUExSUQsNEJBMElDO0FBTUQsTUFBTSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxJQUFJLFFBQVEiLCJmaWxlIjoiYXV0b2RpZmYuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIElucHV0ID0gT3AgfCBudW1iZXJcblxuYWJzdHJhY3QgY2xhc3MgT3Age1xuICBwcm90ZWN0ZWQgYWQ6IEF1dG9EaWZmXG4gIHB1YmxpYyBpZDogbnVtYmVyXG4gIHB1YmxpYyBkZXBlbmRzT246IE9wW11cbiAgcHVibGljIHVzZWRJbjogT3BbXSA9IFtdXG4gIHB1YmxpYyBzdGF0aWMga2V5OiBzdHJpbmdcblxuICBjb25zdHJ1Y3RvcihhZDogQXV0b0RpZmYsIC4uLnBhcmFtczogT3BbXSkge1xuICAgIHRoaXMuYWQgPSBhZFxuICAgIHRoaXMuaWQgPSBhZC5nZXROZXh0SUQoKVxuICAgIHRoaXMuZGVwZW5kc09uID0gcGFyYW1zXG4gICAgZm9yIChjb25zdCBwYXJhbSBvZiBwYXJhbXMpIHtcbiAgICAgIHBhcmFtLnVzZWRJbi5wdXNoKHRoaXMpXG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlZigpOiBzdHJpbmcge1xuICAgIGlmICh0aGlzLnVzZWRJbi5sZW5ndGggPiAxKSB7XG4gICAgICByZXR1cm4gYF9nbHNsYWRfdiR7dGhpcy5pZH1gXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgKCR7dGhpcy5kZWZpbml0aW9uKCl9KWBcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGVyaXZSZWYocGFyYW06IFBhcmFtKTogc3RyaW5nIHtcbiAgICBpZiAodGhpcy51c2VkSW4ubGVuZ3RoID4gMSkge1xuICAgICAgcmV0dXJuIGBfZ2xzbGFkX2R2JHt0aGlzLmlkfV9kJHtwYXJhbS5uYW1lfWBcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGAoJHt0aGlzLmRlcml2YXRpdmUocGFyYW0pfSlgXG4gICAgfVxuICB9XG5cbiAgcHVibGljIGluaXRpYWxpemVyKCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMudXNlZEluLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiBgZmxvYXQgJHt0aGlzLnJlZigpfT0ke3RoaXMuZGVmaW5pdGlvbigpfTtcXG5gXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnJ1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBkZXJpdkluaXRpYWxpemVyKHBhcmFtOiBQYXJhbSk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMudXNlZEluLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiBgZmxvYXQgJHt0aGlzLmRlcml2UmVmKHBhcmFtKX09JHt0aGlzLmRlcml2YXRpdmUocGFyYW0pfTtcXG5gXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnJ1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBpc0NvbnN0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRlcGVuZHNPbi5ldmVyeSgob3ApID0+IG9wLmlzQ29uc3QoKSlcbiAgfVxuXG4gIHB1YmxpYyBkZWVwRGVwZW5kZW5jaWVzKCk6IFNldDxPcD4ge1xuICAgIGNvbnN0IGRlcHMgPSBuZXcgU2V0PE9wPigpXG4gICAgZm9yIChjb25zdCBvcCBvZiB0aGlzLmRlcGVuZHNPbikge1xuICAgICAgZm9yIChjb25zdCBkZXAgb2Ygb3AuZGVlcERlcGVuZGVuY2llcygpLnZhbHVlcygpKSB7XG4gICAgICAgIGRlcHMuYWRkKGRlcClcbiAgICAgIH1cbiAgICAgIGRlcHMuYWRkKG9wKVxuICAgIH1cbiAgICByZXR1cm4gZGVwc1xuICB9XG5cbiAgLy8gQ2hhaW5pbmcgaGVscGVyc1xuICBwdWJsaWMgYWRkKC4uLnBhcmFtczogSW5wdXRbXSkgeyByZXR1cm4gdGhpcy5hZC5hZGQodGhpcywgLi4ucGFyYW1zKSB9XG4gIHB1YmxpYyBzdW0oLi4ucGFyYW1zOiBJbnB1dFtdKSB7IHJldHVybiB0aGlzLmFkLnN1bSh0aGlzLCAuLi5wYXJhbXMpIH1cbiAgcHVibGljIHN1YihiOiBJbnB1dCkgeyByZXR1cm4gdGhpcy5hZC5zdWIodGhpcywgYikgfVxuICBwdWJsaWMgbmVnKCkgeyByZXR1cm4gdGhpcy5hZC5uZWcodGhpcykgfVxuICBwdWJsaWMgbXVsdCguLi5wYXJhbXM6IElucHV0W10pIHsgcmV0dXJuIHRoaXMuYWQubXVsdCh0aGlzLCAuLi5wYXJhbXMpIH1cbiAgcHVibGljIGRpdihiOiBJbnB1dCkgeyByZXR1cm4gdGhpcy5hZC5kaXYodGhpcywgYikgfVxuICBwdWJsaWMgcG93KGI6IElucHV0KSB7IHJldHVybiB0aGlzLmFkLnBvdyh0aGlzLCBiKSB9XG4gIHB1YmxpYyBzcXJ0KCkgeyByZXR1cm4gdGhpcy5hZC5zcXJ0KHRoaXMpIH1cbiAgcHVibGljIHNpbigpIHsgcmV0dXJuIHRoaXMuYWQuc2luKHRoaXMpIH1cbiAgcHVibGljIGNvcygpIHsgcmV0dXJuIHRoaXMuYWQuY29zKHRoaXMpIH1cbiAgcHVibGljIHRhbigpIHsgcmV0dXJuIHRoaXMuYWQuY29zKHRoaXMpIH1cbiAgcHVibGljIG1peChiOiBJbnB1dCwgbWl4OiBJbnB1dCkgeyByZXR1cm4gdGhpcy5hZC5taXgodGhpcywgYiwgbWl4KSB9XG4gIHB1YmxpYyBjbGFtcChtaW46IElucHV0LCBtYXg6IElucHV0KSB7IHJldHVybiB0aGlzLmFkLmNsYW1wKHRoaXMsIG1pbiwgbWF4KSB9XG4gIHB1YmxpYyBtaW4ob3RoZXI6IElucHV0KSB7IHJldHVybiB0aGlzLmFkLm1pbih0aGlzLCBvdGhlcikgfVxuICBwdWJsaWMgbWF4KG90aGVyOiBJbnB1dCkgeyByZXR1cm4gdGhpcy5hZC5tYXgodGhpcywgb3RoZXIpIH1cbiAgcHVibGljIGlmZWxzZSh0aGVuT3A6IElucHV0LCBlbHNlT3A6IElucHV0KSB7IHJldHVybiB0aGlzLmFkLmlmZWxzZSh0aGlzLCB0aGVuT3AsIGVsc2VPcCkgfVxuXG4gIHB1YmxpYyBvdXRwdXQobmFtZTogc3RyaW5nKSB7IHJldHVybiB0aGlzLmFkLm91dHB1dChuYW1lLCB0aGlzKSB9XG4gIHB1YmxpYyBvdXRwdXREZXJpdihuYW1lOiBzdHJpbmcsIHBhcmFtOiBQYXJhbSB8IHN0cmluZykgeyByZXR1cm4gdGhpcy5hZC5vdXRwdXREZXJpdihuYW1lLCBwYXJhbSwgdGhpcykgfVxuXG4gIHB1YmxpYyBhYnN0cmFjdCBkZWZpbml0aW9uKCk6IHN0cmluZ1xuICBwdWJsaWMgYWJzdHJhY3QgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pOiBzdHJpbmdcbn1cblxuYWJzdHJhY3QgY2xhc3MgT3BMaXRlcmFsIGV4dGVuZHMgT3Age1xuICBwdWJsaWMgb3ZlcnJpZGUgaW5pdGlhbGl6ZXIoKSB7IHJldHVybiAnJyB9XG4gIHB1YmxpYyBvdmVycmlkZSBkZXJpdkluaXRpYWxpemVyKCkgeyByZXR1cm4gJycgfVxuICBwdWJsaWMgb3ZlcnJpZGUgcmVmKCkgeyByZXR1cm4gdGhpcy5kZWZpbml0aW9uKCkgfVxuICBwdWJsaWMgb3ZlcnJpZGUgZGVyaXZSZWYocGFyYW06IFBhcmFtKSB7IHJldHVybiB0aGlzLmRlcml2YXRpdmUocGFyYW0pIH1cbn1cblxuY2xhc3MgUGFyYW0gZXh0ZW5kcyBPcExpdGVyYWwge1xuICBwdWJsaWMgbmFtZTogc3RyaW5nXG5cbiAgY29uc3RydWN0b3IoYWQ6IEF1dG9EaWZmLCBuYW1lOiBzdHJpbmcpIHtcbiAgICBzdXBlcihhZClcbiAgICB0aGlzLm5hbWUgPSBuYW1lXG4gIH1cblxuICBpc0NvbnN0KCkgeyByZXR1cm4gZmFsc2UgfVxuICBkZWZpbml0aW9uKCkgeyByZXR1cm4gdGhpcy5uYW1lIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICBpZiAocGFyYW0gPT09IHRoaXMpIHtcbiAgICAgIHJldHVybiAnMS4wJ1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJzAuMCdcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgVmFsdWUgZXh0ZW5kcyBPcExpdGVyYWwge1xuICBwcml2YXRlIHZhbDogbnVtYmVyXG5cbiAgY29uc3RydWN0b3IoYWQ6IEF1dG9EaWZmLCB2YWw6IG51bWJlcikge1xuICAgIHN1cGVyKGFkKVxuICAgIHRoaXMudmFsID0gdmFsXG4gIH1cblxuICBpc0NvbnN0KCkgeyByZXR1cm4gdHJ1ZSB9XG4gIGRlZmluaXRpb24oKSB7IHJldHVybiBgJHt0aGlzLnZhbC50b0ZpeGVkKDQpfWAgfVxuICBkZXJpdmF0aXZlKCkgeyByZXR1cm4gJzAuMCcgfVxufVxuXG5jbGFzcyBOZWcgZXh0ZW5kcyBPcCB7XG4gIGRlZmluaXRpb24oKSB7XG4gICAgcmV0dXJuIGAtJHt0aGlzLmRlcGVuZHNPblswXS5yZWYoKX1gXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICByZXR1cm4gJy0nICsgdGhpcy5kZXBlbmRzT25bMF0uZGVyaXZSZWYocGFyYW0pXG4gIH1cbn1cblxuY2xhc3MgU3VtIGV4dGVuZHMgT3Age1xuICBkZWZpbml0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmRlcGVuZHNPbi5tYXAoKG9wKSA9PiBvcC5yZWYoKSkuam9pbignKycpXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICByZXR1cm4gdGhpcy5kZXBlbmRzT24ubWFwKChvcCkgPT4gb3AuZGVyaXZSZWYocGFyYW0pKS5qb2luKCcrJylcbiAgfVxufVxuXG5jbGFzcyBNdWx0IGV4dGVuZHMgT3Age1xuICBkZWZpbml0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmRlcGVuZHNPbi5tYXAoKG9wKSA9PiBvcC5yZWYoKSkuam9pbignKicpXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICBjb25zdCBbZiwgZ10gPSB0aGlzLmRlcGVuZHNPblxuICAgIHJldHVybiBgJHtmLnJlZigpfSoke2cuZGVyaXZSZWYocGFyYW0pfSske2cucmVmKCl9KiR7Zi5kZXJpdlJlZihwYXJhbSl9YFxuICB9XG59XG5cbmNsYXNzIERpdiBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5kZXBlbmRzT24ubWFwKChvcCkgPT4gb3AucmVmKCkpLmpvaW4oJy8nKVxuICB9XG4gIGRlcml2YXRpdmUocGFyYW06IFBhcmFtKSB7XG4gICAgY29uc3QgW2YsIGddID0gdGhpcy5kZXBlbmRzT25cbiAgICByZXR1cm4gYCgke2YuZGVyaXZSZWYocGFyYW0pfSoke2cucmVmKCl9LSR7Zy5kZXJpdlJlZihwYXJhbSl9KiR7Zi5yZWYoKX0pLygke2cucmVmKCl9KiR7Zy5yZWYoKX0pYFxuICB9XG59XG5cbmNsYXNzIFBvdyBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICByZXR1cm4gYHBvdygke3RoaXMuZGVwZW5kc09uWzBdLnJlZigpfSwke3RoaXMuZGVwZW5kc09uWzFdLnJlZigpfSlgXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICBjb25zdCBbYSwgYl0gPSB0aGlzLmRlcGVuZHNPblxuICAgIGlmIChiLmlzQ29uc3QoKSkge1xuICAgICAgcmV0dXJuIGAke2IucmVmKCl9KnBvdygke2EucmVmKCl9LCR7Yi5yZWYoKX0tMS4wKWBcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBwb3coJHthLnJlZigpfSwke2IucmVmKCl9KSpsb2coJHthLnJlZigpfSkqJHtiLmRlcml2UmVmKHBhcmFtKX1gXG4gICAgfVxuICB9XG59XG5cbmNsYXNzIFNpbiBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICByZXR1cm4gYHNpbigke3RoaXMuZGVwZW5kc09uWzBdLnJlZigpfSlgXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICByZXR1cm4gYGNvcygke3RoaXMuZGVwZW5kc09uWzBdLnJlZigpfSkqJHt0aGlzLmRlcGVuZHNPblswXS5kZXJpdlJlZihwYXJhbSl9YFxuICB9XG59XG5cbmNsYXNzIENvcyBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICByZXR1cm4gYGNvcygke3RoaXMuZGVwZW5kc09uWzBdLnJlZigpfSlgXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICByZXR1cm4gYC1zaW4oJHt0aGlzLmRlcGVuZHNPblswXS5yZWYoKX0pKiR7dGhpcy5kZXBlbmRzT25bMF0uZGVyaXZSZWYocGFyYW0pfWBcbiAgfVxufVxuXG5jbGFzcyBNaXggZXh0ZW5kcyBPcCB7XG4gIGRlZmluaXRpb24oKSB7XG4gICAgcmV0dXJuIGBtaXgoJHt0aGlzLmRlcGVuZHNPbi5tYXAoKG9wKSA9PiBvcC5yZWYoKSkuam9pbignLCcpfSlgXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICBjb25zdCBbYSwgYiwgbWl4XSA9IHRoaXMuZGVwZW5kc09uXG4gICAgY29uc3QgYURlcml2ID0gYCgxLjAtJHthLnJlZigpfSkqJHttaXguZGVyaXZSZWYocGFyYW0pfSsoLSR7YS5kZXJpdlJlZihwYXJhbSl9KSoke21peC5yZWYoKX1gXG4gICAgY29uc3QgYkRlcml2ID0gYCR7Yi5yZWYoKX0qJHttaXguZGVyaXZSZWYocGFyYW0pfSske2IuZGVyaXZSZWYocGFyYW0pfSoke21peC5yZWYoKX1gXG4gICAgcmV0dXJuIGAke2FEZXJpdn0rJHtiRGVyaXZ9YFxuICB9XG59XG5cbmNsYXNzIENsYW1wIGV4dGVuZHMgT3Age1xuICBkZWZpbml0aW9uKCkge1xuICAgIHJldHVybiBgY2xhbXAoJHt0aGlzLmRlcGVuZHNPbi5tYXAoKG9wKSA9PiBvcC5yZWYoKSkuam9pbignLCcpfSlgXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICBjb25zdCBbdiwgbWluLCBtYXhdID0gdGhpcy5kZXBlbmRzT25cbiAgICByZXR1cm4gYCR7di5yZWYoKX08JHttaW4ucmVmKCl9ID8gMC4wIDogKCR7di5yZWYoKX0+JHttYXgucmVmKCl9ID8gMC4wIDogJHt2LmRlcml2UmVmKHBhcmFtKX0pYFxuICB9XG59XG5cbmNsYXNzIE1pbiBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICByZXR1cm4gYG1pbigke3RoaXMuZGVwZW5kc09uLm1hcCgob3ApID0+IG9wLnJlZigpKS5qb2luKCcsJyl9KWBcbiAgfVxuICBkZXJpdmF0aXZlKHBhcmFtOiBQYXJhbSkge1xuICAgIGNvbnN0IFthLCBiXSA9IHRoaXMuZGVwZW5kc09uXG4gICAgcmV0dXJuIGAke2EucmVmKCl9PCR7Yi5yZWYoKX0gPyAke2EuZGVyaXZSZWYocGFyYW0pfSA6ICR7Yi5kZXJpdlJlZihwYXJhbSl9YFxuICB9XG59XG5cbmNsYXNzIE1heCBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICByZXR1cm4gYG1heCgke3RoaXMuZGVwZW5kc09uLm1hcCgob3ApID0+IG9wLnJlZigpKS5qb2luKCcsJyl9KWBcbiAgfVxuICBkZXJpdmF0aXZlKHBhcmFtOiBQYXJhbSkge1xuICAgIGNvbnN0IFthLCBiXSA9IHRoaXMuZGVwZW5kc09uXG4gICAgcmV0dXJuIGAke2EucmVmKCl9PiR7Yi5yZWYoKX0gPyAke2EuZGVyaXZSZWYocGFyYW0pfSA6ICR7Yi5kZXJpdlJlZihwYXJhbSl9YFxuICB9XG59XG5cbmNsYXNzIElmRWxzZSBleHRlbmRzIE9wIHtcbiAgZGVmaW5pdGlvbigpIHtcbiAgICBjb25zdCBbY29uZGl0aW9uLCB0aGVuT3AsIGVsc2VPcF0gPSB0aGlzLmRlcGVuZHNPblxuICAgIHJldHVybiBgJHtjb25kaXRpb24ucmVmKCl9PyR7dGhlbk9wLnJlZigpfToke2Vsc2VPcC5yZWYoKX1gXG4gIH1cbiAgZGVyaXZhdGl2ZShwYXJhbTogUGFyYW0pIHtcbiAgICBjb25zdCBbY29uZGl0aW9uLCB0aGVuT3AsIGVsc2VPcF0gPSB0aGlzLmRlcGVuZHNPblxuICAgIHJldHVybiBgJHtjb25kaXRpb24ucmVmKCl9PyR7dGhlbk9wLmRlcml2UmVmKHBhcmFtKX06JHtlbHNlT3AuZGVyaXZSZWYocGFyYW0pfWBcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQXV0b0RpZmYge1xuICBwcml2YXRlIG5leHRJRCA9IDBcbiAgcHVibGljIGdldE5leHRJRCgpOiBudW1iZXIge1xuICAgIGNvbnN0IGlkID0gdGhpcy5uZXh0SURcbiAgICB0aGlzLm5leHRJRCsrXG4gICAgcmV0dXJuIGlkXG4gIH1cblxuICBwcml2YXRlIHBhcmFtczogeyBba2V5OiBzdHJpbmddOiBQYXJhbSB9ID0ge31cbiAgcHJpdmF0ZSBvdXRwdXRzOiB7IFtrZXk6IHN0cmluZ106IE9wIH0gPSB7fVxuICBwcml2YXRlIGRlcml2T3V0cHV0czogeyBbcGFyYW06IHN0cmluZ106IHsgW2tleTogc3RyaW5nXTogT3AgfSB9ID0ge31cblxuICBwcml2YXRlIGNvbnZlcnRWYWwocGFyYW06IElucHV0KTogT3Age1xuICAgIGlmIChwYXJhbSBpbnN0YW5jZW9mIE9wKSB7XG4gICAgICByZXR1cm4gcGFyYW1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMudmFsKHBhcmFtKVxuICAgIH1cbiAgfVxuICBwcml2YXRlIGNvbnZlcnRWYWxzKHBhcmFtczogSW5wdXRbXSk6IE9wW10ge1xuICAgIHJldHVybiBwYXJhbXMubWFwKChwYXJhbSkgPT4gdGhpcy5jb252ZXJ0VmFsKHBhcmFtKSlcbiAgfVxuXG4gIHB1YmxpYyB2YWwobjogbnVtYmVyKSB7IHJldHVybiBuZXcgVmFsdWUodGhpcywgbikgfVxuICBwdWJsaWMgc3VtKC4uLnBhcmFtczogSW5wdXRbXSkgeyByZXR1cm4gbmV3IFN1bSh0aGlzLCAuLi50aGlzLmNvbnZlcnRWYWxzKHBhcmFtcykpIH1cbiAgcHVibGljIGFkZCguLi5wYXJhbXM6IElucHV0W10pIHsgcmV0dXJuIG5ldyBTdW0odGhpcywgLi4udGhpcy5jb252ZXJ0VmFscyhwYXJhbXMpKSB9XG4gIHB1YmxpYyBzdWIoYTogSW5wdXQsIGI6IElucHV0KSB7XG4gICAgY29uc3QgW29wQSwgb3BCXSA9IHRoaXMuY29udmVydFZhbHMoW2EsIGJdKVxuICAgIHJldHVybiB0aGlzLnN1bShvcEEsIHRoaXMubmVnKG9wQikpXG4gIH1cbiAgcHVibGljIG5lZyh2OiBJbnB1dCkgeyByZXR1cm4gbmV3IE5lZyh0aGlzLCB0aGlzLmNvbnZlcnRWYWwodikpIH1cbiAgcHVibGljIG11bHQoLi4ucGFyYW1zOiBJbnB1dFtdKSB7XG4gICAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDIpIHtcbiAgICAgIHJldHVybiBuZXcgTXVsdCh0aGlzLCAuLi50aGlzLmNvbnZlcnRWYWxzKHBhcmFtcykpXG4gICAgfSBlbHNlIGlmIChwYXJhbXMubGVuZ3RoID4gMikge1xuICAgICAgcmV0dXJuIG5ldyBNdWx0KHRoaXMsIHRoaXMuY29udmVydFZhbHMocGFyYW1zLnNsaWNlKDAsIDEpKVswXSwgdGhpcy5tdWx0KC4uLnBhcmFtcy5zbGljZSgxKSkpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgbXVsdCgpIGNhbGxlZCB3aXRoIHRvbyBmZXcgYXJndW1lbnRzOiAke3BhcmFtc31gKVxuICAgIH1cbiAgfVxuICBwdWJsaWMgZGl2KGE6IElucHV0LCBiOiBJbnB1dCkge1xuICAgIGNvbnN0IFtvcEEsIG9wQl0gPSB0aGlzLmNvbnZlcnRWYWxzKFthLCBiXSlcbiAgICByZXR1cm4gbmV3IERpdih0aGlzLCBvcEEsIG9wQilcbiAgfVxuICBwdWJsaWMgcG93KGE6IElucHV0LCBiOiBJbnB1dCkge1xuICAgIGNvbnN0IFtvcEEsIG9wQl0gPSB0aGlzLmNvbnZlcnRWYWxzKFthLCBiXSlcbiAgICByZXR1cm4gbmV3IFBvdyh0aGlzLCBvcEEsIG9wQilcbiAgfVxuICBwdWJsaWMgc3FydCh2OiBJbnB1dCkgeyByZXR1cm4gbmV3IFBvdyh0aGlzLCB0aGlzLmNvbnZlcnRWYWwodiksIHRoaXMudmFsKDAuNSkpIH1cbiAgcHVibGljIHNpbih2OiBJbnB1dCkgeyByZXR1cm4gbmV3IFNpbih0aGlzLCB0aGlzLmNvbnZlcnRWYWwodikpIH1cbiAgcHVibGljIGNvcyh2OiBJbnB1dCkgeyByZXR1cm4gbmV3IENvcyh0aGlzLCB0aGlzLmNvbnZlcnRWYWwodikpIH1cbiAgcHVibGljIHRhbih2OiBJbnB1dCkge1xuICAgIGNvbnN0IG9wID0gdGhpcy5jb252ZXJ0VmFsKHYpXG4gICAgcmV0dXJuIHRoaXMuZGl2KHRoaXMuc2luKG9wKSwgdGhpcy5jb3Mob3ApKVxuICB9XG4gIHB1YmxpYyBtaXgoYTogSW5wdXQsIGI6IElucHV0LCBtaXg6IElucHV0KSB7IHJldHVybiBuZXcgTWl4KHRoaXMsIC4uLnRoaXMuY29udmVydFZhbHMoW2EsIGIsIG1peF0pKSB9XG4gIHB1YmxpYyBjbGFtcCh2OiBJbnB1dCwgbWluOiBJbnB1dCwgbWF4OiBJbnB1dCkgeyByZXR1cm4gbmV3IENsYW1wKHRoaXMsIC4uLnRoaXMuY29udmVydFZhbHMoW3YsIG1pbiwgbWF4XSkpIH1cbiAgcHVibGljIG1pbihhOiBJbnB1dCwgYjogSW5wdXQpIHsgcmV0dXJuIG5ldyBNaW4odGhpcywgLi4udGhpcy5jb252ZXJ0VmFscyhbYSwgYl0pKSB9XG4gIHB1YmxpYyBtYXgoYTogSW5wdXQsIGI6IElucHV0KSB7IHJldHVybiBuZXcgTWF4KHRoaXMsIC4uLnRoaXMuY29udmVydFZhbHMoW2EsIGJdKSkgfVxuICBwdWJsaWMgaWZlbHNlKGNvbmQ6IElucHV0LCB0aGVuT3A6IElucHV0LCBlbHNlT3A6IElucHV0KSB7IHJldHVybiBuZXcgSWZFbHNlKHRoaXMsIC4uLnRoaXMuY29udmVydFZhbHMoW2NvbmQsIHRoZW5PcCwgZWxzZU9wXSkpIH1cbiAgcHVibGljIGUoKSB7IHJldHVybiB0aGlzLnZhbChNYXRoLkUpIH1cbiAgcHVibGljIHBpKCkgeyByZXR1cm4gdGhpcy52YWwoTWF0aC5QSSkgfVxuXG4gIHB1YmxpYyBwYXJhbShuYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBvcCA9IG5ldyBQYXJhbSh0aGlzLCBuYW1lKVxuICAgIHRoaXMucGFyYW1zW25hbWVdID0gb3BcbiAgICByZXR1cm4gb3BcbiAgfVxuXG4gIHB1YmxpYyBvdXRwdXQobmFtZTogc3RyaW5nLCBvcDogT3ApIHtcbiAgICB0aGlzLm91dHB1dHNbbmFtZV0gPSBvcFxuICB9XG5cbiAgcHVibGljIG91dHB1dERlcml2KG5hbWU6IHN0cmluZywgcGFyYW06IFBhcmFtIHwgc3RyaW5nLCBvcDogT3ApIHtcbiAgICBjb25zdCBwYXJhbU5hbWUgPSB0eXBlb2YgcGFyYW0gPT09ICdzdHJpbmcnID8gcGFyYW0gOiBwYXJhbS5uYW1lXG4gICAgdGhpcy5kZXJpdk91dHB1dHNbcGFyYW1OYW1lXSA9IHRoaXMuZGVyaXZPdXRwdXRzW3BhcmFtTmFtZV0gfHwge31cbiAgICB0aGlzLmRlcml2T3V0cHV0c1twYXJhbU5hbWVdW25hbWVdID0gb3BcbiAgfVxuXG4gIHB1YmxpYyBnZW4oKTogc3RyaW5nIHtcbiAgICBsZXQgY29kZSA9ICcnXG5cbiAgICAvLyBBZGQgaW5pdGlhbGl6ZXJzIGZvciBvdXRwdXRzXG4gICAgY29uc3QgZGVwcyA9IG5ldyBTZXQ8T3A+KClcbiAgICBmb3IgKGNvbnN0IG5hbWUgaW4gdGhpcy5vdXRwdXRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGRlcCBvZiB0aGlzLm91dHB1dHNbbmFtZV0uZGVlcERlcGVuZGVuY2llcygpLnZhbHVlcygpKSB7XG4gICAgICAgIGRlcHMuYWRkKGRlcClcbiAgICAgIH1cbiAgICAgIGRlcHMuYWRkKHRoaXMub3V0cHV0c1tuYW1lXSlcbiAgICB9XG4gICAgZm9yIChjb25zdCBwYXJhbSBpbiB0aGlzLmRlcml2T3V0cHV0cykge1xuICAgICAgZm9yIChjb25zdCBuYW1lIGluIHRoaXMuZGVyaXZPdXRwdXRzW3BhcmFtXSkge1xuICAgICAgICBmb3IgKGNvbnN0IGRlcCBvZiB0aGlzLmRlcml2T3V0cHV0c1twYXJhbV1bbmFtZV0uZGVlcERlcGVuZGVuY2llcygpLnZhbHVlcygpKSB7XG4gICAgICAgICAgZGVwcy5hZGQoZGVwKVxuICAgICAgICB9XG4gICAgICAgIGRlcHMuYWRkKHRoaXMuZGVyaXZPdXRwdXRzW3BhcmFtXVtuYW1lXSlcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBkZXAgb2YgZGVwcy52YWx1ZXMoKSkge1xuICAgICAgY29kZSArPSBkZXAuaW5pdGlhbGl6ZXIoKVxuICAgIH1cblxuICAgIC8vIEFkZCBvdXRwdXRzXG4gICAgZm9yIChjb25zdCBuYW1lIGluIHRoaXMub3V0cHV0cykge1xuICAgICAgY29kZSArPSBgZmxvYXQgJHtuYW1lfT0ke3RoaXMub3V0cHV0c1tuYW1lXS5yZWYoKX07XFxuYFxuICAgIH1cblxuICAgIGZvciAoY29uc3QgcGFyYW0gaW4gdGhpcy5kZXJpdk91dHB1dHMpIHtcbiAgICAgIGNvbnN0IHBhcmFtT3AgPSB0aGlzLnBhcmFtc1twYXJhbV1cblxuICAgICAgLy8gQWRkIGluaXRpYWxpemVycyBmb3IgZGVyaXZhdGl2ZSBvdXRwdXRzXG4gICAgICBjb25zdCBkZXJpdkRlcHMgPSBuZXcgU2V0PE9wPigpXG4gICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gdGhpcy5kZXJpdk91dHB1dHNbcGFyYW1dKSB7XG4gICAgICAgIGZvciAoY29uc3QgZGVwIG9mIHRoaXMuZGVyaXZPdXRwdXRzW3BhcmFtXVtuYW1lXS5kZWVwRGVwZW5kZW5jaWVzKCkudmFsdWVzKCkpIHtcbiAgICAgICAgICBkZXJpdkRlcHMuYWRkKGRlcClcbiAgICAgICAgfVxuICAgICAgICBkZXJpdkRlcHMuYWRkKHRoaXMuZGVyaXZPdXRwdXRzW3BhcmFtXVtuYW1lXSlcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgZGVwIG9mIGRlcml2RGVwcy52YWx1ZXMoKSkge1xuICAgICAgICBjb2RlICs9IGRlcC5kZXJpdkluaXRpYWxpemVyKHBhcmFtT3ApXG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBkZXJpdmF0aXZlIG91dHB1dHNcbiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiB0aGlzLmRlcml2T3V0cHV0c1twYXJhbV0pIHtcbiAgICAgICAgY29kZSArPSBgZmxvYXQgJHtuYW1lfT0ke3RoaXMuZGVyaXZPdXRwdXRzW3BhcmFtXVtuYW1lXS5kZXJpdlJlZihwYXJhbU9wKX07XFxuYFxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb2RlXG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgcHVibGljIHN0YXRpYyBnZW4oY2I6IChhZDogQXV0b0RpZmYpID0+IE9wKTogc3RyaW5nIHtcbiAgICBjb25zdCBhZCA9IG5ldyBBdXRvRGlmZigpXG4gICAgY2IoYWQpXG4gICAgcmV0dXJuIGFkLmdlbigpXG4gIH1cbn1cblxuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGludGVyZmFjZSBXaW5kb3cgeyBBdXRvRGlmZjogYW55OyB9XG59XG53aW5kb3cuQXV0b0RpZmYgPSB3aW5kb3cuQXV0b0RpZmYgfHwgQXV0b0RpZmZcbiJdLCJzb3VyY2VSb290IjoiIn0=